[build]
  command = "npm run build"
  publish = ".next"

[functions]
  directory = "netlify/functions"
  # Increase timeout for background functions (they run async)
  node_bundler = "esbuild"

[build.environment]
  NODE_ENV = "production"
  # Omit local .env files and Netlify internal build output from secrets scanning
  SECRETS_SCAN_OMIT_PATHS = ".env.local,hakivo-api/.env.local,hakivo-api/hakivo-api/.env.local,.netlify"
  # Production Raindrop Cloud backend URLs
  # API_BASE_URL is used for auth endpoints (signin, callback)
  NEXT_PUBLIC_API_URL = "https://svc-01ka8k5e6tr0kgy0jkzj9m4q15.01k66gywmx8x4r0w31fdjjfekf.lmapp.run"
  # DASHBOARD_API_URL is used for dashboard data endpoints
  NEXT_PUBLIC_DASHBOARD_API_URL = "https://svc-01ka8k5e6tr0kgy0jkzj9m4q19.01k66gywmx8x4r0w31fdjjfekf.lmapp.run"
  # BILLS_API_URL for backend bills-service (server-side routes need this)
  NEXT_PUBLIC_BILLS_API_URL = "https://svc-01ka8k5e6tr0kgy0jkzj9m4q16.01k66gywmx8x4r0w31fdjjfekf.lmapp.run"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# Only redirect semantic-search (CORS workaround for client-side requests)
# Let Next.js handle all other /api/bills/* routes (analyze, detail, etc.)
[[redirects]]
  from = "/api/bills/semantic-search"
  to = "https://svc-01ka8k5e6tr0kgy0jkzj9m4q16.01k66gywmx8x4r0w31fdjjfekf.lmapp.run/bills/semantic-search"
  status = 200
  force = true
