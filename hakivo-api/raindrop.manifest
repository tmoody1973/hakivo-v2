application "hakivo-new" {

  // Environment variables for API keys
  env "WORKOS_API_KEY" {
    secret = true
  }

  env "WORKOS_CLIENT_ID" {
    secret = true
  }

  env "WORKOS_REDIRECT_URI" {
    secret = true
  }

  env "GEOCODIO_API_KEY" {
    secret = true
  }

  env "JWT_SECRET" {
    secret = true
  }

  env "EXA_API_KEY" {
    secret = true
  }

  env "CONGRESS_API_KEY" {
    secret = true
  }

  env "GEMINI_API_KEY" {
    secret = true
  }

  env "CEREBRAS_API_KEY" {
    secret = true
  }

  env "ANTHROPIC_API_KEY" {
    secret = true
  }

  env "ELEVENLABS_API_KEY" {
    secret = true
  }

  env "VULTR_ENDPOINT" {
    secret = true
  }

  env "VULTR_ACCESS_KEY" {
    secret = true
  }

  env "VULTR_SECRET_KEY" {
    secret = true
  }

  env "VULTR_BUCKET_NAME" {
    secret = true
  }

  // Public-facing HTTP services
  service "auth-service" {
    visibility = "public"
  }

  service "bills-service" {
    visibility = "public"
  }

  service "briefs-service" {
    visibility = "public"
  }

  service "chat-service" {
    visibility = "public"
  }

  service "dashboard-service" {
    visibility = "public"
  }

  service "admin-dashboard" {
    visibility = "public"
  }

  service "db-admin" {
    visibility = "private"
  }

  // Private internal services
  service "user-service" {
    visibility = "private"
  }

  service "congress-api-client" {
    visibility = "private"
  }

  service "geocodio-client" {
    visibility = "private"
  }

  service "claude-client" {
    visibility = "private"
  }

  service "elevenlabs-client" {
    visibility = "private"
  }

  service "cerebras-client" {
    visibility = "private"
  }

  service "exa-client" {
    visibility = "private"
  }

  service "vultr-storage-client" {
    visibility = "private"
  }

  // Background workers
  observer "brief-generator" {
    source {
      queue = "brief-queue"
    }
  }

  observer "congress-sync-observer" {
    source {
      queue = "sync-queue"
    }
  }

  observer "enrichment-observer" {
    source {
      queue = "enrichment-queue"
    }
  }

  observer "bill-indexing-observer" {
    source {
      queue = "bill-indexing-queue"
    }
  }

  // Scheduled tasks
  task "daily-brief-scheduler" {
    type = "cron"
    cron = "0 7 * * *"
  }

  task "weekly-brief-scheduler" {
    type = "cron"
    cron = "0 7 * * 1"
  }

  task "congress-sync-scheduler" {
    type = "cron"
    cron = "0 2 * * *"
  }

  task "news-sync-scheduler" {
    type = "cron"
    cron = "0 8,14,20 * * *"
  }

  task "congress-actions-scheduler" {
    type = "cron"
    cron = "0 6,18 * * *"
  }

  // Admin utilities
  service "index-bills-service" {
    visibility = "public"
  }

  // Message queues
  queue "brief-queue" {}

  queue "sync-queue" {}

  queue "enrichment-queue" {}

  queue "bill-indexing-queue" {}

  // SQL database for application data
  sql_database "app-db" {}

  // KV caches for performance
  kv_cache "news-cache" {}

  kv_cache "dashboard-cache" {}

  kv_cache "district-cache" {}

  kv_cache "session-cache" {}

  kv_cache "image-cache" {}

  kv_cache "actions-cache" {}

  // SmartBuckets for storage with automatic search
  smartbucket "bill-texts" {}

  smartbucket "audio-briefs" {}
}
